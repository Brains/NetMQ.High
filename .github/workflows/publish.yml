name: Publish NuGet

on:
  push:
    tags:
    - '*'

jobs:
  publish:
    name   : Build and Publish NuGet package
    runs-on: windows-latest
    steps  :

      - name : Get the version
        run  : echo ::set-env name=VERSION::${GITHUB_REF#refs/tags/}
        shell: bash

      - name: Checkout repo
        uses: actions/checkout@v2

      - name: Pack package
        run : dotnet pack .\src\NetMQ.High\NetMQ.High.csproj -c Release -p:Version=$env:VERSION

      - name: Push generated package to the GitHub registry
        run : dotnet nuget push .\src\NetMQ.High\bin\Release\NetMQ.High.$env:VERSION.nupkg --api-key qz2jga8pl3dvn2akksyquwcs9ygggg4exypy3bhxy6w6x6 --source https://api.nuget.org/v3/index.json